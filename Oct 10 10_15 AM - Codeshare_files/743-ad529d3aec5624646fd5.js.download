"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{4567:function(e,n,t){t.d(n,{Ke:function(){return r},_y:function(){return c},us:function(){return s}});t(24603),t(39714);const r="x-codeshare-auth-mutation",o=["deleteMe","login","logout","register","registerAnonymous","usePasswordReset"],c=new RegExp("^(".concat(o.join("|"),")"),"i"),s=new RegExp("(".concat(o.join("|"),")[(]"),"i");new RegExp("(".concat(o.join("|"),"):"),"i")},50559:function(e,n,t){var r=t(22431);n.Z=r.Z},92432:function(e,n,t){t.d(n,{Z:function(){return c}});t(66992),t(33948);var r=t(53028);var o={fatal:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.error?console.error("FATAL!",...n):console.log("FATAL:",...n)},error:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.error?console.error(...n):console.log("ERROR:",...n)},warn:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.warn?console.warn(...n):console.log("WARN:",...n)},info:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.info?console.info(...n):console.log("INFO:",...n)},debug:function(){if(r.Z){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.debug?console.debug(...n):console.log("DEBUG:",...n)}},trace:function(){if(r.Z){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];console.trace?console.trace(...n):console.log("TRACE:",...n)}}},c=(0,t(15934).Z)("~/helpers/serverLogger",!0)||o},51726:function(e,n,t){t.d(n,{MX:function(){return I},ZP:function(){return A},er:function(){return P},i:function(){return T},oE:function(){return N}});var r=t(15861),o=t(4942),c=t(87757),s=t.n(c),i=(t(54747),t(92222),t(57327),t(49337),t(4567)),u=t(41719),a=t(35367),l=t(77243),_=t(50559),d=t(5313);var p=t(25427),f=t(36765),b=t(34555),E=t(53028),O=t(92432),w=t(63200),v=t(32216);function g(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function R(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?g(Object(t),!0).forEach((function(n){(0,o.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):g(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}const C=(0,w.q)((e=>{O.Z.debug("subscriptionClient errorLink",{arg:e});const n=e.graphQLErrors,t=e.networkError;n&&n.forEach((e=>{var n,t,r;O.Z.debug("subscriptionClient GraphQL error",{err:e});const o=null!==(n=null===(t=e.extensions)||void 0===t||null===(r=t.exception)||void 0===r?void 0:r.status)&&void 0!==n?n:500;401===o?(0,v.Qj)({closeReason:v.GB.AUTH_ERROR,dontReconnect:!0}):429===o&&(0,v.$2)()})),t&&O.Z.debug("subscriptionClient Network error",{err:t})}));let D,h;function N(){const e=T();return e.status===e.wsImpl.CLOSED}function T(){return _.Z.assert(h,"'subscriptionClient' is missing"),h}function Z(e){let n=e.reconnect,t=void 0===n||n,r=e.closedByUser,o=void 0===r||r;O.Z.debug("subscriptionClient closeSubscriptionClient!");const c=!t;t?(console.log("subscriptionClient tryReconnect",{reconnect:h.reconnect}),h.clearTryReconnectTimeout(),h.clearMaxConnectTimeout(),h.tryReconnect()):h.close(c,o)}function I(){O.Z.debug("subscriptionClient attempt reconnect!"),Z({reconnect:!0})}function P(){O.Z.debug("subscriptionClient dont reconnect!"),Z({reconnect:!1})}function A(e){e.url;let n=e.headers;const t=new u.u({uri:"".concat(window.location.protocol,"//").concat(window.location.host).concat("/-/api","/graphql"),headers:R(R({},n),{},{[i.Ke]:!0})});return h=new d.SubscriptionClient("".concat("https:"===window.location.protocol?"wss:":"ws:","//").concat(window.location.host).concat("/-/api","/graphql"),{connectionParams:function(){var e=(0,r.Z)(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{headers:n});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),connectionCallback:e=>{if(null!=e){O.Z.debug("subscriptionClient Network error",{err:e});try{const n=JSON.parse(e.message);401===n.status?(0,v.Qj)({closeReason:v.GB.AUTH_ERROR,dontReconnect:!0}):429===n.status?(0,v.$2)():(0,v.Qj)({closeReason:v.GB.UNKNOWN,dontReconnect:!0})}catch(n){(0,v.Qj)()}}},reconnect:!0},null,"codeshare-graphql-ws"),D=new p.A(h),(0,v.d)(h),(0,a.V)((e=>{var n;let t=e.query;const r=(0,f.p$)(t);return b.Z&&"OperationDefinition"===r.kind&&"mutation"===r.operation&&i._y.test(function(e){var n,t,r,o;return(null===(n=e.selectionSet)||void 0===n?void 0:n.selections)&&(null===(t=e.selectionSet)||void 0===t||null===(r=t.selections[0])||void 0===r||null===(o=r.name)||void 0===o?void 0:o.value)}(r)||(null===(n=r.name)||void 0===n?void 0:n.value)||"")}),t,(0,l.D)([C,D]))}b.Z&&E.Z&&(window.getSubscriptionClient=T,window.attemptReconnect=I,window.dontReconnect=P)},60496:function(e,n,t){t.d(n,{H:function(){return D},Z:function(){return C}});var r=t(15861),o=t(87757),c=t.n(o),s=t(50559),i=t(44311),u=t(85060),a=t.n(u),l=t(4567),_=t(51726),d=t(47037),p=t(34555),f=t(53028);function b(){s.Z.assert(p.Z,"onDisconnect should only be used on clientside"),(0,_.MX)()}p.Z&&f.Z&&(window.forceReconnect=b);var E=t(8799);var O=function(e){const n=(0,_.ZP)({url:"http://api",headers:e});return i.Network.create(((e,t)=>a().create((r=>(0,d.h)(n,{query:(0,E.Qc)(e.text),variables:t}).subscribe({next:r.next,error:r.error,complete:()=>{l.us.test(e.text)&&b(),r.complete()}})))),((e,t,r,o)=>{const c=a().create((r=>(0,d.h)(n,{query:(0,E.Qc)(e.text),variables:t}).subscribe({next:r.next,error:r.error,complete:r.complete})));return o?c.subscribe((function(e){return o.onNext({data:e})}),o.onError,o.onCompleted):c}))};let w;var v=t(73855),g=t(15934);const R=e=>{let n=e.apiHeaders,t=e.records;if(v.Z){s.Z.assert(n,"apiHeaders is required",{apiHeaders:n,records:t});return(0,g.Z)("~/relay/createServerEnvironment")({apiHeaders:n,records:t})}return function(e){let n=e.records;if(w)return w;const t=new i.RecordSource(n),r=new i.Store(t),o=O();return w=new i.Environment({handlerProvider:null,network:o,store:r}),w}({records:t})};var C=R;const D=function(){var e=(0,r.Z)(c().mark((function e(n){var t,r,o,i,u,a,l,_,d,p;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.req,r=n.res,o=n.logger,i=n.forceNewSession,!v.Z){e.next=21;break}if(s.Z.assert(t,"server: ctx is missing req"),s.Z.assert(r,"server: ctx is missing res"),s.Z.assert(o,"server: ctx is missing logger"),a=(0,g.Z)("~/helpers/SessionHelper"),l=new a({req:t,res:r,logger:o}),!i){e.next=13;break}return e.next=10,l.logout(!0);case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,l.getOrCreate();case 15:e.t0=e.sent;case 16:_=e.t0,d=_.token,u={authorization:"token ".concat(d),"x-forwarded-for":t.headers["x-forwarded-for"]||t.socket.remoteAddress},e.next=21;break;case 21:return p=R({apiHeaders:u}),e.abrupt("return",{apiHeaders:u,environment:p});case 23:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()},34555:function(e,n,t){const r=!t(73855).Z;n.Z=r},53028:function(e,n){n.Z=!1},73855:function(e,n){n.Z=!1},70230:function(e,n,t){function r(e){var n,t;const r=null!==e&&void 0!==e&&e.source?e:null===e||void 0===e?void 0:e.originalError;return(null===r||void 0===r||null===(n=r.source)||void 0===n?void 0:n.errors)&&(null===r||void 0===r||null===(t=r.source)||void 0===t?void 0:t.errors[0])}t.d(n,{Z:function(){return r}})},15934:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return serverRequire}});var core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(15306),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(92222),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_1__),_isServer__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(73855),path__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(26470),path__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__),process=__webpack_require__(34155);function pathHelper(e){let n=e.replace("~",(0,path__WEBPACK_IMPORTED_MODULE_2__.join)(process.cwd(),process.env.PREBUILT?"/.dist":""));return e!==n?"".concat(n).concat(process.env.PREBUILT?"":".ts"):n}function serverRequire(path,force){if(!_isServer__WEBPACK_IMPORTED_MODULE_3__.Z){if(!force)throw new Error('Cannot serverRequire "'.concat(path,'" in the browser'));return}let _path=pathHelper(path);const _req=eval("require");return path!==_path?_req(_path).default:_req(_path)}},32216:function(e,n,t){t.d(n,{QK:function(){return a},GB:function(){return l},$2:function(){return f},Qj:function(){return b},d:function(){return w},bJ:function(){return g}});var r=t(4942),o=(t(66992),t(70189),t(33948),t(54747),t(57327),t(49337),t(67294)),c=t(51726),s=t(92432);function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function u(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){(0,r.Z)(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}let a,l;!function(e){e.CONNECTING="connecting",e.RECONNECTING="reconnecting",e.CONNECTED="connected",e.DISCONNECTED="disconnected"}(a||(a={})),function(e){e.AUTH_ERROR="auth_error",e.INVALID_DATA="invalid_data",e.RATE_LIMITED="rate_limited",e.POLICY_VIOLATION="policy_violation",e.CLOSED_BY_USER="closed_by_user",e.UNKNOWN="unknown"}(l||(l={}));const _=()=>{s.Z.warn("subscriptionClient blockedReconnect!!")};let d={status:a.DISCONNECTED,closeReason:l.UNKNOWN,dontReconnect:!1,disconnectedAt:new Date};const p=new Set;function f(){b({closeReason:l.RATE_LIMITED,dontReconnect:!0,blockReconnectFor:9e4})}function b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.closeReason,t=void 0===n?l.UNKNOWN:n,r=e.dontReconnect,o=void 0!==r&&r,c=e.blockReconnectFor,s=void 0===c?void 0:c;O({status:a.DISCONNECTED,closeReason:t,disconnectedAt:new Date,dontReconnect:o,blockReconnectFor:s})}let E=null;function O(e){const n=d;if(e.status===a.DISCONNECTED&&n.status===a.DISCONNECTED)return void s.Z.warn("subscriptionClient updateConnectionState blocked!",{prev:n,next:e});s.Z.debug("subscriptionClient updateConnectionState",{prev:n,next:e}),d=e;const t=d.blockReconnectFor,r=(0,c.i)();function o(e){s.Z.debug("subscriptionClient unblockReconnect"),E&&clearTimeout(E),E=null,null!=e.__connect&&(e.connect=e.__connect,e.__connect=null)}t?(!function(e){if(e.__connect)return;s.Z.debug("subscriptionClient blockReconnect"),e.__connect=e.connect,e.connect=_}(r),E=setTimeout((()=>{o(r)}),t)):o(r),d.dontReconnect&&(0,c.er)(),p.forEach((e=>e(d)))}function w(e){e.on("close",(e=>{s.Z.debug("subscriptionClient close",{event:e});const n=function(e){switch(e){case 1e3:case 1001:return l.CLOSED_BY_USER;case 1002:case 1003:case 1007:return l.INVALID_DATA;case 1008:case 1009:return l.POLICY_VIOLATION;case 4001:return l.AUTH_ERROR;case 4008:return l.RATE_LIMITED;case 1006:case 1010:case 1011:case 1012:case 1013:case 1014:case 1015:default:return l.UNKNOWN}}(e.code);switch(n){case l.CLOSED_BY_USER:return b({closeReason:n,dontReconnect:!0});case l.RATE_LIMITED:return f();case l.POLICY_VIOLATION:return b({closeReason:l.POLICY_VIOLATION,dontReconnect:!0,blockReconnectFor:3e4});case l.INVALID_DATA:case l.UNKNOWN:default:return b({closeReason:n})}})),e.on("error",(e=>{s.Z.debug("subscriptionClient error",{err:e}),b()})),e.on("disconnected",(()=>{s.Z.debug("subscriptionClient disconnected"),b()})),e.on("connecting",(()=>{s.Z.debug("subscriptionClient connecting"),O({status:a.CONNECTING})})),e.on("reconnecting",(()=>{s.Z.debug("subscriptionClient reconnecting"),O({status:a.RECONNECTING})})),e.on("connected",(()=>{s.Z.debug("subscriptionClient connected"),O({status:a.CONNECTED})})),e.on("reconnected",(()=>{s.Z.debug("subscriptionClient reconnected"),O({status:a.CONNECTED})}))}function v(){const e=(0,o.useState)(d),n=e[0],t=e[1],r=(0,o.useState)(null),c=r[0],s=r[1];return(0,o.useEffect)((()=>{const e=e=>t(e);return p.add(e),()=>{p.delete(e)}}),[]),(0,o.useEffect)((()=>{n.blockReconnectFor&&null===c&&s(n.blockReconnectFor/1e3)}),[n.blockReconnectFor,c]),(0,o.useEffect)((()=>{if(null===c||c<=0)return;const e=setTimeout((()=>{s((e=>e&&e>0?e-1:0))}),1e3);return()=>clearTimeout(e)}),[c]),u(u({},n),{},{reconnectCountdown:c})}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1500;const n=v(),t=n.status,r=n.dontReconnect,c=(0,o.useState)(!1),s=c[0],i=c[1],l=(0,o.useState)(!1),_=l[0],d=l[1];return(0,o.useEffect)((()=>{let n=null;const o=()=>{n&&clearTimeout(n)};return t!==a.DISCONNECTED?(i(!1),d(!1),o):r?(i(!0),d(!0),o):(i(!0),n=setTimeout((()=>{d(!0)}),e),o)}),[t,r,e]),u({isDisconnected:s,isDisconnectedForDuration:_},n)}}}]);