<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Visualizer</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9fafc;
      padding: 30px;
      text-align: center;
    }
    h1 { color: #333; margin-bottom: 20px; }
    .container {
      max-width: 900px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    input[type="file"], select, button { margin: 10px; padding: 10px; font-size: 16px; }
    button {
      border: none; background: #007bff; color: white; border-radius: 8px; cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #0056b3; }
    .tabs { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
    .tab { cursor: pointer; padding: 10px 20px; border-radius: 8px; background: #eee; }
    .tab.active { background: #007bff; color: white; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #007bff; color: white; }
    canvas { max-width: 100%; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Data Visualizer</h1>

    <div class="tabs">
      <div class="tab active" data-tab="dataTab">CSV Data</div>
      <div class="tab" data-tab="chartTab">Chart</div>
    </div>

    <div class="tab-content active" id="dataTab">
      <input type="file" id="fileInput" accept=".csv" />
      <table id="csvTable"></table>
    </div>

    <div class="tab-content" id="chartTab">
      <select id="chartType">
        <option value="bar">Bar Chart</option>
        <option value="line">Line Chart</option>
        <option value="pie">Pie Chart</option>
        <option value="doughnut">Doughnut Chart</option>
      </select>
      <button id="generateChartBtn">Generate Chart</button>
      <canvas id="chart"></canvas>
    </div>
  </div>

  <script>
    let realEstateData = [];
    let chartInstance = null;

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    // Parse CSV
    const parseCSV = (content) => {
      const rows = content.trim().split("\n");
      const headers = rows[0].split(",");
      return rows.slice(1).map(row => {
        const values = row.split(",");
        let obj = {};
        headers.forEach((h, i) => obj[h.trim()] = values[i]?.trim());
        return obj;
      });
    };

    const displayTable = (data) => {
      const table = document.getElementById('csvTable');
      if (!data.length) { table.innerHTML = ""; return; }
      const headers = Object.keys(data[0]);
      table.innerHTML = `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>` +
                        data.map(row => `<tr>${headers.map(h => `<td>${row[h]}</td>`).join('')}</tr>`).join('');
    };

   
    document.getElementById('fileInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (event) => {
        realEstateData = parseCSV(event.target.result);
        displayTable(realEstateData);
        alert("CSV uploaded successfully!");
      };
      reader.readAsText(file);
    });

    // Reset Chart
    const resetChart = () => {
      if (chartInstance) chartInstance.destroy();
    };

    // Generate Chart
    document.getElementById('generateChartBtn').addEventListener('click', () => {
      if (!realEstateData.length) return alert("Upload CSV first!");
      resetChart();
      const chartType = document.getElementById('chartType').value;
      const ctx = document.getElementById('chart').getContext('2d');

      if (chartType === 'pie' || chartType === 'doughnut') {
        const statusCounts = {};
        realEstateData.forEach(d => {
          const status = d.Status || "Unknown";
          statusCounts[status] = (statusCounts[status] || 0) + 1;
        });
        chartInstance = new Chart(ctx, {
          type: chartType,
          data: {
            labels: Object.keys(statusCounts),
            datasets: [{
              data: Object.values(statusCounts),
              backgroundColor: ['#007bff','#28a745','#ffc107','#dc3545']
            }]
          },
          options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });
      } else {
        const propertyNames = realEstateData.map(d => d.Property_Name);
        const prices = realEstateData.map(d => parseFloat(d["Price(INR_Lakhs)"]) || 0);
        chartInstance = new Chart(ctx, {
          type: chartType,
          data: {
            labels: propertyNames,
            datasets: [{
              label: 'Price (in Lakhs)',
              data: prices,
              backgroundColor: 'rgba(54, 162, 235, 0.6)',
              borderColor: '#007bff',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: { y: { beginAtZero: true } },
          }
        });
      }

     
      document.querySelector('[data-tab="chartTab"]').click();
    });
  </script>
</body>
</html>
